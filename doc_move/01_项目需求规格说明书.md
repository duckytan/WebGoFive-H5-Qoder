# 01 项目需求规格说明书

## 文档目的

完整、准确地定义H5五子棋项目的所有功能需求、技术规格、验收标准，为AI和开发者提供明确的实现目标。

---

## 1. 产品概述

### 1.1 产品定位
一款**零依赖、完全离线、功能完整**的HTML5五子棋游戏，面向五子棋爱好者提供多模式对战、AI挑战和VCF战术训练。

### 1.2 目标用户
- 五子棋初学者：通过VCF练习学习基本战术
- 五子棋爱好者：与AI对弈提升棋力
- 休闲玩家：双人对战、机机对战观赏
- 开发者：作为Canvas游戏和AI算法的学习案例

### 1.3 核心价值
- **完整规则**：严格遵循五子棋规则，包括复杂的禁手判定
- **多层AI**：4级难度满足不同水平玩家需求
- **VCF训练**：系统化的战术练习，填补国内在线五子棋的空白
- **零依赖**：无需网络、无需安装，打开即用

---

## 2. 功能需求

### 2.1 基础游戏功能

#### 2.1.1 棋盘与棋子
| 项目 | 规格 | 说明 |
|------|------|------|
| 棋盘规格 | 15×15线交叉棋盘 | 共225个交叉点 |
| 坐标系统 | 横向x(0-14)，纵向y(0-14) | 左上角(0,0)，右下角(14,14) |
| 棋子颜色 | 黑（1）、白（2） | 空位（0） |
| 先手规则 | 黑棋先手 | board[y][x]=1为黑棋 |
| 落子方式 | 点击交叉点 | 支持鼠标和触摸 |
| 星位标记 | 5个星位点 | 天元(7,7)、四角(3,3)等 |

**数据结构**：
```javascript
board: Array<Array<number>> = [
    [0, 0, 0, ..., 0],  // 第0行
    [0, 0, 0, ..., 0],  // 第1行
    ...
    [0, 0, 0, ..., 0]   // 第14行
]
// 0=空, 1=黑棋, 2=白棋
```

#### 2.1.2 获胜条件
| 条件 | 判定规则 | 优先级 |
|------|----------|--------|
| 五连获胜 | 横/竖/斜任一方向连成5子 | 最高（优先于禁手） |
| 长连禁手 | 黑棋六连及以上为禁手（不是获胜） | 仅对黑棋 |
| 平局 | 棋盘下满(225手)且无人获胜 | 最低 |

**判定算法**：
```javascript
checkWin(x, y) {
    directions = [
        {dx: 1, dy: 0},   // 横向 →
        {dx: 0, dy: 1},   // 纵向 ↓
        {dx: 1, dy: 1},   // 主对角 ↘
        {dx: 1, dy: -1}   // 副对角 ↗
    ]
    
    for each direction:
        count = countLine(x, y, dx, dy)
        if count == 5: return 胜利
        if count >= 6 and player == 1: return 禁手（不胜利）
    
    return 继续
}
```

#### 2.1.3 禁手规则（仅限黑棋）

##### 三三禁手
**定义**：一步棋同时形成**两个或以上**的活三。

**活三形态**：
```
连三型：  _●●●_    (需要5格空间)
跳三型A： _●●_●_   (连二跳一，需6格空间)
跳三型B： _●_●●_   (跳一连二，需6格空间)
```

**判定逻辑**：
```javascript
checkForbidden(x, y) {
    if (player !== 1) return false;  // 仅黑棋有禁手
    
    // 临时落子
    board[y][x] = 1;
    
    // 统计各方向的活三
    liveThreeCount = 0;
    for each direction:
        if isLiveThree(x, y, direction):
            liveThreeCount++;
    
    board[y][x] = 0;  // 撤销
    
    return liveThreeCount >= 2;
}
```

**重要规则**：
- 活三必须两端都有空位可延伸成活四
- 睡三（一端被堵）不算活三
- 跳三在双端有空时才算活三

##### 四四禁手
**定义**：一步棋同时形成**两个或以上**的四（活四或冲四）。

**四的分类**：
```
活四（Live Four）： _●●●●_  (两端都能成五)
冲四（Rush Four）： ●●●●_ 或 _●●●● 或 ●●_●● 或 ●_●●● (只有一端能成五)
```

**判定逻辑**：
```javascript
checkDoubleFour(x, y) {
    fourCount = 0;
    for each direction:
        if hasFour(x, y, direction):  // 活四或冲四
            fourCount++;
    
    return fourCount >= 2;
}
```

##### 长连禁手
**定义**：一步棋形成**六子或以上**的连线。

**判定逻辑**：
```javascript
checkLongLine(x, y) {
    for each direction:
        count = countConsecutive(x, y, direction);
        if count >= 6:
            return true;  // 禁手
    return false;
}
```

**特殊规则**：
- 长连是禁手，不是获胜（黑棋需要刚好五连）
- 白棋无长连禁手，六连以上也算获胜

#### 2.1.4 游戏状态管理
```javascript
gameStatus: 'ready' | 'playing' | 'finished'
currentPlayer: 1 | 2  // 当前该下棋的玩家
winner: null | 0 | 1 | 2  // null=未结束, 0=平局, 1=黑胜, 2=白胜
moves: Array<{x, y, player, step, timestamp}>  // 落子历史
startTime: number | null  // 游戏开始时间戳
endTime: number | null    // 游戏结束时间戳
```

---

### 2.2 游戏模式

#### 2.2.1 双人对战模式 (PvP)
| 特性 | 说明 |
|------|------|
| 模式标识 | `gameMode = 'PvP'` |
| 玩家数量 | 2人（本地轮流操作） |
| 落子顺序 | 黑棋先手，严格轮换 |
| AI介入 | 无AI参与 |
| 禁手应用 | 黑棋检测禁手，白棋无限制 |
| 适用场景 | 两人在同一设备对弈 |

**交互流程**：
```
游戏开始 → 黑棋落子 → 判定（获胜/禁手/继续）
        → 白棋落子 → 判定（获胜/继续）
        → 黑棋落子 → ...
        → 直到游戏结束
```

#### 2.2.2 人机对战模式 (PvE)
| 特性 | 说明 |
|------|------|
| 模式标识 | `gameMode = 'PvE'` |
| 玩家身份 | 玩家执黑，AI执白 |
| AI难度 | 可选：新手/正常/困难/地狱 |
| AI思考时间 | 500ms-1800ms（根据难度） |
| 友好性设计 | 显示"AI思考中"动画 |

**AI难度配置**：
| 难度 | 算法深度 | 思考时间 | 胜率目标 | 特殊策略 |
|------|----------|----------|----------|----------|
| 新手 | 深度2 | 500ms | 25% | 简单评分+随机干扰 |
| 正常 | 深度4 | 900ms | 50% | Alpha-Beta剪枝 |
| 困难 | 深度6 | 1400ms | 75% | 威胁序列搜索 |
| 地狱 | 深度8 | 1800ms | 90% | VCF搜索+完整威胁空间 |

**交互流程**：
```
游戏开始 → 玩家(黑)落子 → 判定
        → AI(白)思考（延迟） → AI落子 → 判定
        → 玩家落子 → ...
```

#### 2.2.3 机机对战模式 (EvE)
| 特性 | 说明 |
|------|------|
| 模式标识 | `gameMode = 'EvE'` |
| 参与方 | 黑方AI vs 白方AI |
| 难度设置 | 黑方AI难度、白方AI难度独立设置 |
| 自动进行 | 自动轮流落子，玩家仅观战 |
| 速度控制 | 每步延迟400ms（可调） |
| 用途 | AI算法测试、观赏 |

**交互限制**：
- 玩家无法在棋盘上落子
- 点击棋盘显示提示："机机对战模式，玩家无法操作"
- 可随时通过"新游戏"或"切换模式"中断

**交互流程**：
```
游戏开始 → 黑方AI落子 → 延迟400ms → 判定
        → 白方AI落子 → 延迟400ms → 判定
        → 循环直到游戏结束
```

#### 2.2.4 VCF练习模式 ★特色功能★
| 特性 | 说明 |
|------|------|
| 模式标识 | `gameMode = 'VCF_PRACTICE'` |
| 功能定位 | VCF(Victory by Continuous Four)战术专题训练 |
| 题库规模 | 40道经典题目 |
| 难度等级 | 4级：入门(1-2步)、初级(3-4步)、中级(5-6步)、高级(7+步) |
| AI防守 | 固定为地狱难度(HELL) |
| 游戏目标 | 在限定步数内获胜 |
| 进度追踪 | LocalStorage持久化，记录完成题目、最佳时间、连胜数 |

**题库结构**：
```javascript
puzzle = {
    id: 'vcf-level1-001',
    title: '入门第1题：星位金钩',
    description: '黑棋已经在星位形成金钩冲四，只差补上正中缺口。',
    level: 1,  // 1-4
    layout: [  // 初始棋盘布局
        [6, 7, 1], [7, 7, 1], [8, 7, 1],  // [x, y, player]
        [5, 7, 2], [9, 7, 2]
    ],
    minMoves: 1,   // 最少获胜步数
    maxMoves: 6,   // 允许的最多步数
    tags: ['入门', '金钩', '冲四']
}
```

**等级分布**：
- **等级1（入门）**：10题，1-2步获胜，单步冲四、简单连环
- **等级2（初级）**：10题，3-4步获胜，双向威胁、梯形攻势
- **等级3（中级）**：10题，5-6步获胜，多步连环、复杂防守
- **等级4（高级）**：10题，7+步获胜，深层VCF、妙手序列

**游戏流程**：
```
选择等级 → 加载题目 → 展示初始棋盘
        → 玩家(黑)落子 → AI(白)防守(400ms延迟)
        → 玩家继续落子 → ...
        → 判定：获胜(步数符合) / 超步失败 / 被反杀失败
        → 更新进度和最佳记录
        → 下一题或重试
```

**自动升级机制**：
- 完成5题自动推荐进入下一难度
- 完成10题自动提示"已通关本等级"

**进度数据结构**：
```javascript
progress = {
    level: 1-4,  // 当前等级
    completed: [题目ID数组],  // 已完成的题目
    bestTimes: {
        'vcf-level1-001': 15,  // 题目ID: 最快完成时间(秒)
        'vcf-level1-002': 23,
        ...
    },
    winStreak: 5,  // 当前连胜数
    totalWins: 28, // 总胜场
    totalLosses: 12 // 总失败
}
```

**UI元素**：
- VCF练习面板：题目标题、描述、难度标签
- 进度显示：等级、已完成题数、连胜数
- 最佳记录：历史最快完成时间
- 等级选择器：下拉菜单切换难度
- 重试/下一题按钮

---

### 2.3 用户交互

#### 2.3.1 基本操作
| 操作 | 交互方式 | 反馈 | 边界条件 |
|------|----------|------|----------|
| 落子 | 点击交叉点 | 棋子出现+声音（可选） | 该点为空、未结束、轮到玩家 |
| 悬停预览 | 鼠标移动 | 半透明预览棋子 | 该点为空 |
| 禁手提示 | 尝试禁手位置 | 红色高亮+提示文字1.8s | 黑棋落禁手位置 |
| 获胜显示 | 游戏结束 | 弹窗+获胜动画+统计 | 五连或对方认输 |

**落子验证流程**：
```javascript
placePiece(x, y) {
    // 1. 基础验证
    if (!isValidPosition(x, y)) return ERROR;
    if (board[y][x] !== 0) return "该位置已有棋子";
    if (gameStatus === 'finished') return "游戏已结束";
    
    // 2. 模式权限检查
    if (gameMode === 'EvE' && !isAI) return "机机对战模式禁止操作";
    if (gameMode === 'PvE' && currentPlayer === 2) return "等待AI落子";
    
    // 3. 禁手检查（仅黑棋）
    if (currentPlayer === 1) {
        forbidden = checkForbidden(x, y);
        if (forbidden.isForbidden) {
            return {error: forbidden.type, highlight: true};
        }
    }
    
    // 4. 执行落子
    board[y][x] = currentPlayer;
    moves.push({x, y, player: currentPlayer, ...});
    
    // 5. 判定胜负
    if (checkWin(x, y)) {
        gameStatus = 'finished';
        winner = currentPlayer;
        return {gameOver: true, winner};
    }
    
    // 6. 切换玩家
    currentPlayer = (currentPlayer === 1) ? 2 : 1;
    return {success: true};
}
```

#### 2.3.2 游戏控制
| 功能 | 按钮 | 快捷键 | 行为 |
|------|------|--------|------|
| 新游戏 | "🎮 新游戏" | `Ctrl+N` | 清空棋盘，重置状态，保持当前模式 |
| 悔棋 | "↩️ 悔棋" | `Ctrl+Z` | PvP:退一步, PvE:退两步(玩家+AI), VCF:退两步 |
| 切换模式 | "🔄 切换模式" | `M` | 循环切换PvE→PvP→EvE→PvE |
| 提示 | "💡 获取提示" | `H` | 调用AI计算建议落点，高亮显示5秒 |
| 设置 | "⚙️ 设置" | - | 打开设置弹窗 |
| 帮助 | "❓ 规则说明" | `F1` | 打开帮助弹窗 |

**悔棋逻辑**：
```javascript
undoMove() {
    if (moves.length === 0) return "无棋可悔";
    
    stepsToUndo = (gameMode === 'PvP') ? 1 : 2;  // PvE/VCF退两步
    
    for (i = 0; i < stepsToUndo; i++) {
        lastMove = moves.pop();
        board[lastMove.y][lastMove.x] = 0;
    }
    
    currentPlayer = moves.length % 2 === 0 ? 1 : 2;
    gameStatus = 'playing';
    winner = null;
    
    render();
}
```

**提示功能**：
```javascript
showHint() {
    // 冷却检查
    if (Date.now() - lastHintTime < hintCooldown) {
        return "提示冷却中，请等待3秒";
    }
    
    // 调用AI计算
    hintDifficulty = settings.hintStrength || 'NORMAL';
    bestMove = game.getAIMove(hintDifficulty);
    
    // 高亮显示
    boardRenderer.highlightHintPosition(bestMove.x, bestMove.y, {
        duration: 5000  // 5秒后自动消失
    });
    
    lastHintTime = Date.now();
}
```

#### 2.3.3 棋局管理
| 功能 | 触发方式 | 文件格式 | 数据内容 |
|------|----------|----------|----------|
| 保存棋局 | "💾 保存棋局" | JSON | 棋盘、历史、模式、时间、设置 |
| 加载棋局 | "📁 加载棋局" | JSON | 解析并验证，恢复状态 |
| 自动保存 | 每30秒（可关闭） | LocalStorage | 仅当前棋局 |
| 棋局回放 | "⏯️ 棋局回放" | - | 逐步回放历史记录 |

**保存文件格式**：
```json
{
  "version": "1.2.0",
  "gameInfo": {
    "mode": "PvE",
    "difficulty": "HARD",
    "startTime": "2025-01-15T10:30:00.000Z",
    "endTime": "2025-01-15T10:45:32.000Z",
    "result": "black_win"
  },
  "boardState": [
    [0, 0, 0, ..., 0],
    ...
  ],
  "moves": [
    {"x": 7, "y": 7, "player": 1, "step": 1, "timestamp": 1705315800000},
    {"x": 8, "y": 8, "player": 2, "step": 2, "timestamp": 1705315801200},
    ...
  ],
  "currentPlayer": 1,
  "moveCount": 25,
  "gameTime": 932,
  "settings": {...}
}
```

**加载验证**：
```javascript
validateGameData(data) {
    requiredFields = ['version', 'gameInfo', 'boardState', 'moves'];
    for (field of requiredFields) {
        if (!data[field]) throw Error(`缺少字段: ${field}`);
    }
    
    if (data.boardState.length !== 15) throw Error("无效的棋盘数据");
    if (!Array.isArray(data.moves)) throw Error("无效的移动记录");
    
    // 版本兼容性检查
    supportedVersions = ['1.0.0', '1.0.1', '1.1.0', '1.2.0'];
    if (!supportedVersions.includes(data.version)) {
        throw Error(`不兼容的版本: ${data.version}`);
    }
}
```

#### 2.3.4 回放控制
| 控制 | 按钮 | 功能 |
|------|------|------|
| 播放/暂停 | ▶️/⏸️ | 自动播放或暂停 |
| 上一步 | ⏪ | 后退一步 |
| 下一步 | ⏩ | 前进一步 |
| 回到开始 | ⏮ | 跳到第0步 |
| 跳到最后 | ⏭ | 跳到最后一步 |
| 进度条 | 滑块 | 拖动跳转到任意步 |
| 速度 | 0.5x/1x/2x/3x | 调节播放速度 |
| 步骤列表 | 📝 | 显示/隐藏步骤详情 |
| 导出 | 💾 | 导出为JSON文件 |
| 关闭 | ✖️ | 退出回放模式 |

**回放实现**：
```javascript
class GameReplay {
    replayEngine: GomokuGame  // 独立引擎，不影响主游戏
    
    seekToStep(targetStep) {
        // 重建棋盘到目标步骤
        replayEngine.reset();
        for (i = 0; i < targetStep; i++) {
            move = replayData.moves[i];
            replayEngine.placePiece(move.x, move.y);
        }
        boardRenderer.render();
    }
    
    startPlaying(speed) {
        interval = setInterval(() => {
            if (currentStep < totalSteps) {
                seekToStep(currentStep + 1);
            } else {
                pausePlaying();
            }
        }, 1000 / speed);
    }
}
```

---

### 2.4 AI系统

#### 2.4.1 AI算法架构
```
AI决策流程（地狱难度完整版）:

1. 立即获胜检测
   ├─ 遍历候选点
   ├─ 模拟落子
   ├─ 判定五连
   └─ 返回获胜点

2. 立即防守检测
   ├─ 检测对手获胜点
   └─ 返回防守点

3. VCF搜索 (仅HELL)
   ├─ 找到所有冲四点
   ├─ 对每个冲四点递归搜索
   ├─ 检查对手所有防守
   ├─ 深度限制10层
   └─ 返回VCF必胜点

4. VCF防守 (仅HELL)
   ├─ 检测对手的VCF威胁
   └─ 返回防守点

5. 关键威胁防守 (HARD+)
   ├─ 检测双活三
   ├─ 检测活四
   └─ 返回防守点

6. 活三防守 (HARD+)
   ├─ 找到对手所有活三
   └─ 选择最优防守点

7. Alpha-Beta搜索
   ├─ 生成候选移动
   ├─ 递归搜索（深度2-8根据难度）
   ├─ Alpha-Beta剪枝
   └─ 返回最高评分点

8. 降级策略
   └─ 返回任意合法点
```

#### 2.4.2 评分表
```javascript
scoreTable = {
    // 基础棋型
    five: 1000000,           // 五连（立即获胜）
    openFour: 160000,        // 活四 _●●●●_
    closedFour: 42000,       // 冲四 ●●●●_
    brokenFour: 55000,       // 断四 ●●_●●
    openThree: 12000,        // 活三 _●●●_
    closedThree: 2600,       // 睡三 ●●●__
    brokenThree: 6200,       // 断三 ●●_●_
    openTwo: 600,            // 活二 _●●_
    closedTwo: 150,          // 睡二 ●●___
    baseOpen: 35,            // 基础开放位置
    
    // 组合威胁（关键加分）
    doubleOpenFour: 420000,  // 双活四（必胜）
    doubleBrokenFour: 200000,// 双冲四（强制活四）
    doubleOpenThree: 36000,  // 双活三（接近必胜）
    openFourSupport: 120000, // 活四+支援
    openBrokenThreeCombo: 18000, // 活三+断三组合
    doubleClosedFour: 32000, // 双冲四
    doubleClosedThree: 9000  // 双睡三
}
```

#### 2.4.3 开局库（ADVANCED算法）
```javascript
openingBook = {
    // 第一手：天元最优
    first: [{x: 7, y: 7}],
    
    // 第二手：对称应对
    second: [
        {pattern: [[7,7]], responses: [[6,6], [8,8], [6,8], [8,6]]},
        {pattern: [[7,7]], responses: [[7,6], [7,8], [6,7], [8,7]]}
    ],
    
    // 常见开局定式
    sequences: [
        {name: '瑞星', moves: [[7,7], [6,7], [7,6]], weight: 10},
        {name: '花月', moves: [[7,7], [7,6], [6,6]], weight: 9},
        {name: '恒星', moves: [[7,7], [8,6], [7,6]], weight: 8}
    ]
}
```

---

### 2.5 UI/UX需求

#### 2.5.1 布局结构
```
┌────────────────────────────────────────────┐
│  Header: 游戏标题 + 版本 + 提示/设置/帮助     │
├────────────┬───────────────────────────────┤
│  Sidebar   │      Game Board              │
│  (300px)   │      (Canvas 600x600)        │
│            │                              │
│  - 当前玩家 │                              │
│  - 游戏状态 │                              │
│  - 控制按钮 │                              │
│  - AI设置   │                              │
│  - VCF面板  │                              │
│            │                              │
│            │  下方：提示信息 / 回放控制器   │
└────────────┴───────────────────────────────┘
```

#### 2.5.2 视觉设计规范
| 元素 | 样式规范 |
|------|----------|
| **棋盘背景** | #f4e4bc（木质浅色） |
| **网格线条** | #654321（深棕色），1px |
| **黑棋** | 径向渐变：#4a4a4a → #1a1a1a，阴影2px |
| **白棋** | 径向渐变：#ffffff → #f8f8f8，阴影2px |
| **星位点** | 半径3px，填充#654321 |
| **最后一手** | 红色小圆点（标记上一步） |
| **禁手高亮** | 红色半透明圆圈+边框，持续1.8s |
| **提示高亮** | 绿色虚线圆圈+十字，持续5s |
| **悬停预览** | 半透明棋子（opacity: 0.5） |

**CSS变量定义**：
```css
:root {
  --board-wood-light: #f4e4bc;
  --board-line-color: #654321;
  --piece-black: #1a1a1a;
  --piece-white: #f8f8f8;
  --primary-color: #8b4513;
  --success-color: #4caf50;
  --error-color: #f44336;
  --border-radius: 8px;
  --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
}
```

#### 2.5.3 响应式设计
| 屏幕宽度 | 布局调整 |
|----------|----------|
| ≥1024px | 标准布局（侧边栏 + 棋盘） |
| 768-1023px | 缩小棋盘，侧边栏窄化 |
| <768px | 棋盘上方，侧边栏下方，单列布局 |

#### 2.5.4 动画效果
| 动画 | 时长 | 缓动函数 |
|------|------|----------|
| 落子动画 | 300ms | ease-out |
| 禁手高亮 | 1800ms | ease-in-out |
| 提示高亮 | 5000ms | linear |
| 按钮悬停 | 150ms | ease |
| 弹窗出现 | 300ms | ease-out |
| 获胜动画 | 1000ms | ease-in-out |

---

### 2.6 数据持久化

#### 2.6.1 LocalStorage使用
| 键名 | 数据类型 | 说明 |
|------|----------|------|
| `gomoku_auto_save` | JSON | 自动保存的当前棋局 |
| `gomoku_settings` | JSON | 用户设置（AI难度、音效等） |
| `vcf_practice_progress_v3` | JSON | VCF练习进度 |
| `gomoku_history` | JSON | 对局历史记录（最多20条） |

**设置数据结构**：
```javascript
settings = {
    defaultMode: 'PvE',
    defaultDifficulty: 'NORMAL',
    defaultHintStrength: 'NORMAL',
    boardTheme: 'classic',
    soundEffects: true,
    animations: true,
    aiAlgorithmMode: 'CLASSIC',
    riskIndicator: true,
    coordinateDisplay: false,
    autoSave: true,
    forbiddenHints: true,
    hintCooldown: 3000
}
```

#### 2.6.2 自动保存策略
```javascript
autoSave() {
    if (!settings.autoSave) return;
    
    interval = setInterval(() => {
        if (game.gameStatus === 'playing' && game.moves.length > 0) {
            data = game.exportData();
            localStorage.setItem('gomoku_auto_save', JSON.stringify(data));
            console.log('自动保存成功');
        }
    }, 30000);  // 每30秒
}
```

---

## 3. 非功能需求

### 3.1 性能要求
| 指标 | 目标 | 测量方法 |
|------|------|----------|
| 页面加载时间 | <2秒 | Chrome DevTools Network |
| 落子响应时间 | <100ms | 点击到渲染完成 |
| AI计算时间 | 新手:500ms, 正常:900ms, 困难:1400ms, 地狱:1800ms | 实际计时 |
| 渲染帧率 | ≥60fps | Canvas刷新率 |
| 内存占用 | <50MB | Chrome DevTools Memory |

### 3.2 兼容性要求
| 浏览器 | 最低版本 | 测试状态 |
|--------|----------|----------|
| Chrome | 60+ | 必须支持 |
| Firefox | 55+ | 必须支持 |
| Safari | 12+ | 必须支持 |
| Edge | 79+ | 必须支持 |
| Mobile Safari | 11+ | 可选支持 |
| Chrome Android | 60+ | 可选支持 |

### 3.3 可访问性要求
- Canvas元素提供`aria-label`描述
- 按钮提供`title`提示
- 键盘快捷键支持
- 高对比度模式（可选）

### 3.4 安全性要求
- 无外部依赖，无XSS风险
- LocalStorage数据本地存储，无泄露风险
- 文件加载时验证JSON格式和版本兼容性

---

## 4. 验收标准

### 4.1 功能验收清单
- [ ] **基础规则**：五连获胜判定100%准确
- [ ] **禁手检测**：三三、四四、长连检测准确率100%
- [ ] **PvP模式**：双人轮流对弈，无卡顿
- [ ] **PvE模式**：AI响应时间符合规格，胜率符合目标
- [ ] **EvE模式**：自动对弈流畅，玩家无法干预
- [ ] **VCF模式**：40题可正常游玩，进度正确追踪
- [ ] **游戏保存**：保存/加载功能正常，数据完整
- [ ] **游戏回放**：所有控制按钮工作正常，播放流畅
- [ ] **悔棋功能**：PvP退1步，PvE/VCF退2步，状态正确恢复
- [ ] **提示功能**：AI计算准确，高亮清晰，冷却生效

### 4.2 性能验收清单
- [ ] 首次加载<2秒（4G网络）
- [ ] 落子响应<100ms
- [ ] AI计算时间符合各难度要求
- [ ] 无内存泄漏（长时间运行内存稳定）
- [ ] Canvas渲染流畅60fps

### 4.3 兼容性验收清单
- [ ] Chrome 60+测试通过
- [ ] Firefox 55+测试通过
- [ ] Safari 12+测试通过
- [ ] Edge 79+测试通过
- [ ] 移动端触摸操作正常（可选）

### 4.4 用户体验验收清单
- [ ] 界面美观，符合木质主题
- [ ] 操作直观，新手5分钟上手
- [ ] 错误提示友好，无技术术语
- [ ] 响应式布局，768px+屏幕体验良好
- [ ] 所有弹窗可通过ESC或点击背景关闭

---

## 5. 约束条件

### 5.1 技术约束
- **无依赖**：不使用任何npm包或外部库
- **无构建**：不使用Webpack、Babel等构建工具
- **纯前端**：无后端API调用，完全静态
- **浏览器API**：仅使用标准Web API（Canvas、LocalStorage、FileReader）

### 5.2 业务约束
- **离线运行**：必须在无网络环境下完全可用
- **单机游戏**：不支持在线对战或联网功能
- **开源项目**：代码开源，MIT协议

### 5.3 开发约束
- **代码规范**：遵循ES6+标准，无eval、with等危险语法
- **注释要求**：关键函数必须有中文注释
- **模块导出**：统一使用`window.*`方式导出

---

## 6. 附录

### 6.1 术语表
| 术语 | 说明 |
|------|------|
| **VCF** | Victory by Continuous Four，连续冲四必胜法 |
| **活三** | 两端都能延伸成活四的三子连线 |
| **活四** | 两端都能成五的四子连线 |
| **冲四** | 只有一端能成五的四子连线 |
| **禁手** | 黑棋不能下的位置（三三、四四、长连） |
| **Alpha-Beta剪枝** | Minimax搜索的优化算法 |
| **威胁序列** | 连续形成威胁的落子序列 |

### 6.2 参考文档
- 原项目代码：`game-core.js`, `demo.js`, `board-renderer.js`
- 规则文档：`docs/design/五子棋规则与算法.md`
- 用户指南：`docs/user/user-guide.md`

---

**文档版本**: v1.0  
**最后更新**: 2025-01  
**下一篇**: [02_技术架构设计文档.md](./02_技术架构设计文档.md)
