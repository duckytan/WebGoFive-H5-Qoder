# 05 - 重新开发任务规划清单

> **目的**: 为AI提供明确的开发步骤，按阶段逐步实现完整功能

---

## 开发策略

### 分阶段开发原则
1. **由简到繁**: 先核心后扩展
2. **可测试性**: 每完成一个模块立即测试
3. **增量迭代**: 每个阶段都可独立运行
4. **质量优先**: 宁可多花时间打好基础，不留技术债

---

## 阶段0: 环境准备 (预计1小时)

### 0.1 创建项目结构
```bash
mkdir gomoku-game
cd gomoku-game
mkdir js css
touch index.html
touch js/utils.js js/game-core.js js/board-renderer.js js/demo.js
touch css/style.css css/animations.css
```

### 0.2 创建index.html骨架
- [ ] 基础HTML5声明
- [ ] 引入CSS文件
- [ ] 创建基本DOM结构
- [ ] 按依赖顺序引入JS模块

**验收**: 打开index.html无报错，控制台空白

---

## 阶段1: 核心功能 (预计4-6小时)

### 1.1 GameUtils工具模块 (js/utils.js)
- [ ] `showMessage(message, type, duration)` - 消息提示
- [ ] `formatTime(timestamp)` - 时间格式化
- [ ] `formatDuration(seconds)` - 时长格式化
- [ ] `generateFileName(prefix, extension)` - 文件名生成
- [ ] `deepClone(obj)` - 深拷贝
- [ ] `isValidPosition(x, y, size)` - 坐标验证
- [ ] `saveToLocalStorage(key, data)` - 存储
- [ ] `loadFromLocalStorage(key)` - 读取
- [ ] `downloadAsJSON(data, filename)` - 下载
- [ ] 导出到`window.GameUtils`

**验收**:
```javascript
console.log(GameUtils.formatTime(Date.now())); // "12:34:56"
console.log(GameUtils.isValidPosition(7, 7));  // true
```

### 1.2 GomokuGame核心引擎 (js/game-core.js) - Part 1: 基础
- [ ] 初始化15x15棋盘
- [ ] `placePiece(x, y)` - 基本落子逻辑（暂不含禁手）
- [ ] `isValidPosition(x, y)` - 坐标验证
- [ ] `getLine(x, y, dx, dy, player)` - 获取连线
- [ ] `checkWin(x, y)` - 胜负判定
- [ ] `getBoardState()` - 获取棋盘状态
- [ ] `reset()` - 重置棋盘
- [ ] `moves` - 历史记录数组

**验收**:
```javascript
const game = new GomokuGame();
game.placePiece(7, 7);  // {success: true}
game.placePiece(7, 7);  // {success: false, error: '该位置已有棋子'}
```

### 1.3 SimpleBoardRenderer渲染器 (js/board-renderer.js)
- [ ] Canvas初始化和尺寸设置
- [ ] `render()` - 渲染完整棋盘
- [ ] `drawBoard()` - 绘制网格
- [ ] `drawPieces()` - 绘制所有棋子
- [ ] `setupEventListeners()` - 鼠标事件
- [ ] `placePiece(x, y)` - 调用game.placePiece
- [ ] 悬停预览效果

**验收**: 打开页面可见15x15棋盘，点击可落子

### 1.4 InterfaceDemo UI控制器 (js/demo.js) - 基础版
- [ ] 初始化并检查依赖
- [ ] `handleMoveResult(result)` - 处理落子结果
- [ ] `startNewGame()` - 新游戏
- [ ] `updateModeDisplay()` - 更新界面文本
- [ ] 绑定"新游戏"按钮
- [ ] 显示当前玩家

**验收**: 可以下棋、新游戏按钮工作、界面显示正确

### 1.5 基础样式 (css/style.css)
- [ ] 木质棋盘背景
- [ ] 棋子样式（黑白、光泽）
- [ ] 布局（Grid）
- [ ] 按钮样式
- [ ] 响应式设计基础

**里程碑M1验收**: 完整的双人对战模式，可落子、判胜负、重新开始

---

## 阶段2: 规则完善 (预计3-4小时)

### 2.1 禁手检测 (js/game-core.js) - Part 2
- [ ] `checkForbidden(x, y)` - 禁手入口
- [ ] `checkLongLine(x, y, player)` - 长连检测
- [ ] `countOpenThrees(x, y, player)` - 活三统计
- [ ] `countOpenFours(x, y, player)` - 活四统计
- [ ] `getLineSignature(x, y, dx, dy, player, range)` - 线性签名
- [ ] `countOpenThreesInLine(signature)` - 活三模式匹配
- [ ] `countOpenFoursInLine(signature)` - 活四模式匹配
- [ ] 在`placePiece`中集成禁手检测

**验收**:
```javascript
// 构造三三局面
game.checkForbidden(x, y);  // {isForbidden: true, type: '三三禁手'}
```

### 2.2 禁手可视化 (js/board-renderer.js)
- [ ] `highlightForbiddenPosition(x, y, result)` - 红色高亮
- [ ] `drawForbiddenHighlight()` - 在render()中绘制
- [ ] 定时清除高亮

**验收**: 点击禁手位置，显示红色标记和提示

### 2.3 悔棋功能
- [ ] `game.undo()` - 撤销最近一步
- [ ] demo中绑定悔棋按钮
- [ ] 更新渲染
- [ ] 按钮启用/禁用逻辑

**验收**: 悔棋按钮工作，棋盘正确恢复

**里程碑M2验收**: 禁手检测正确，禁手可视化，支持悔棋

---

## 阶段3: AI系统 (预计5-6小时)

### 3.1 AI基础 (js/game-core.js) - Part 3
- [ ] `getCandidateMoves(range, limit)` - 候选点生成
- [ ] `evaluatePosition(x, y, player)` - 简单评分
- [ ] `getAIMove(difficulty='NORMAL')` - AI决策入口
- [ ] `getAIMoveBeginner()` - 新手AI
- [ ] `getAIMoveNormal()` - 正常AI
- [ ] `findWinningMove(player)` - 找必胜点

**验收**:
```javascript
game.setGameMode('PvE');
game.placePiece(7, 7);  // 玩家落子
const aiMove = game.getAIMove('NORMAL');  // AI决策
console.log(aiMove);  // {x: 7, y: 8}
```

### 3.2 高级AI (js/ai-advanced.js)
- [ ] `AdvancedAI`类定义
- [ ] `getMove(difficulty)` - 高级决策
- [ ] `iterativeDeepeningSearch()` - 迭代加深
- [ ] `searchVCF(player, depth, maxDepth)` - VCF搜索
- [ ] `searchThreatSequence()` - 威胁序列
- [ ] `initOpeningBook()` - 开局库
- [ ] 集成到game-core

**验收**: HELL难度AI能找到VCF必胜序列

### 3.3 AI UI集成 (js/demo.js)
- [ ] `executeAIMove()` - 执行AI落子
- [ ] AI思考延迟和"思考中"提示
- [ ] `aiThinking`状态锁
- [ ] AI难度选择器
- [ ] PvE/EvE模式支持
- [ ] 模式切换按钮

**验收**: PvE模式AI自动应对，EvE模式双方自动对弈

**里程碑M3验收**: 4级AI难度可用，模式切换正常

---

## 阶段4: 存档回放 (预计4-5小时)

### 4.1 存档管理 (js/game-save-load.js)
- [ ] `GameSaveLoad`类定义
- [ ] `getCurrentGameData()` - 收集游戏数据
- [ ] `saveGame()` - 保存为JSON文件
- [ ] `loadGame()` - 触发文件选择
- [ ] `handleFileLoad(event)` - 读取文件
- [ ] `loadGameFromData(data)` - 恢复游戏
- [ ] `validateGameData(data)` - 数据验证
- [ ] `restoreGameState(data)` - 恢复状态
- [ ] 自动保存（可选）

**验收**: 可保存棋局并重新加载，状态完全恢复

### 4.2 回放系统 (js/game-replay.js)
- [ ] `GameReplay`类定义
- [ ] `startReplay(gameData)` - 开始回放
- [ ] `play()` / `pause()` - 播放/暂停
- [ ] `stepForward()` / `stepBackward()` - 单步
- [ ] `jumpToStep(index)` - 跳转
- [ ] `setSpeed(speed)` - 速度调节
- [ ] UI控制器（类音乐播放器）
- [ ] 进度条拖动

**验收**: 回放界面显示，可播放/暂停/跳转/调速

**里程碑M4验收**: 存档/加载/回放完整流程无错误

---

## 阶段5: VCF练习 (预计4-6小时)

### 5.1 VCF管理器 (js/vcf-practice.js)
- [ ] `VCFPracticeManager`类定义
- [ ] `initializePuzzles()` - 题库初始化
- [ ] `generateLevel1Puzzles()` - 10道入门题
- [ ] `generateLevel2Puzzles()` - 10道初级题
- [ ] `generateLevel3Puzzles()` - 10道中级题
- [ ] `generateLevel4Puzzles()` - 10道高级题
- [ ] `getRandomPuzzle(level)` - 随机选题
- [ ] `validateMove(x, y)` - 验证玩家走法
- [ ] `advanceStep()` - 前进步骤
- [ ] `isComplete()` - 完成判定
- [ ] `loadProgress()` / `saveProgress()` - 进度存储

**验收**: 可加载题目，验证正确性

### 5.2 VCF UI集成 (js/demo.js + index.html)
- [ ] VCF面板HTML结构
- [ ] `startVCFPractice(level)` - 开始练习
- [ ] `handleVCFPracticeMove(x, y)` - VCF落子处理
- [ ] `executeVCFAIDefense()` - AI防守
- [ ] `restartVCFPuzzle()` - 重新练习
- [ ] 难度选择器
- [ ] 进度显示
- [ ] 完成提示

**验收**: VCF模式可正常练习，进度保存

**里程碑M5验收**: 40道VCF题库可用，进度追踪正常

---

## 阶段6: UX优化 (预计3-4小时)

### 6.1 提示系统
- [ ] AI提示功能 (`showHint()`)
- [ ] 提示冷却时间 (3秒)
- [ ] 高亮提示位置
- [ ] 提示按钮状态管理

### 6.2 动画效果 (css/animations.css)
- [ ] 棋子落下动画
- [ ] 胜利线条动画
- [ ] 按钮悬停效果
- [ ] 模态框淡入淡出
- [ ] AI思考点点点动画

### 6.3 设置系统
- [ ] 设置模态框UI
- [ ] 坐标显示开关
- [ ] 风险提示开关
- [ ] 音效开关（可选）
- [ ] 动画开关
- [ ] 设置持久化

### 6.4 帮助系统
- [ ] 帮助模态框UI
- [ ] 规则说明
- [ ] 禁手示例图解
- [ ] 快捷键列表
- [ ] VCF教程

### 6.5 响应式优化
- [ ] 移动端布局调整
- [ ] 触摸事件优化
- [ ] 字体大小适配
- [ ] 按钮尺寸调整

**里程碑M6验收**: 全部辅助功能可用，移动端友好

---

## 阶段7: 测试与发布 (预计2-3小时)

### 7.1 功能测试
- [ ] 所有游戏模式测试
- [ ] 禁手边界情况测试
- [ ] AI各难度测试
- [ ] 存档/加载测试
- [ ] 回放测试
- [ ] VCF练习测试

### 7.2 兼容性测试
- [ ] Chrome最新版
- [ ] Firefox最新版
- [ ] Safari (桌面+移动)
- [ ] Edge (Chromium)

### 7.3 性能测试
- [ ] 页面加载时间
- [ ] Canvas渲染帧率
- [ ] AI响应时间
- [ ] 内存占用

### 7.4 代码质量
- [ ] ESLint检查
- [ ] 控制台无错误/警告
- [ ] 注释完整性
- [ ] 命名一致性

### 7.5 发布准备
- [ ] 创建.gitignore
- [ ] 编写README.md
- [ ] 生成LICENSE
- [ ] 配置GitHub Pages

---

## 开发建议

### 优先级标记
- **P0**: 必须完成，核心功能
- **P1**: 重要功能
- **P2**: 增强功能
- **P3**: 未来功能

### 时间估算
- 阶段0: 1h
- 阶段1-2: 7-10h (P0)
- 阶段3: 5-6h (P0)
- 阶段4: 4-5h (P1)
- 阶段5: 4-6h (P1)
- 阶段6: 3-4h (P2)
- 阶段7: 2-3h

**总计**: 约26-35小时

### 每日目标建议
- Day 1: 阶段0-1
- Day 2: 阶段2
- Day 3: 阶段3
- Day 4: 阶段4
- Day 5: 阶段5
- Day 6: 阶段6-7

---

## 质量检查清单

### 每个模块完成后
- [ ] 代码无语法错误
- [ ] 模块正确导出到window
- [ ] 功能符合需求规格
- [ ] 控制台无错误
- [ ] 简单手动测试通过

### 每个阶段完成后
- [ ] 里程碑验收通过
- [ ] 与前面阶段集成无冲突
- [ ] 性能指标达标
- [ ] 代码提交到Git

---

**下一步推荐阅读**: [06_开发建议与最佳实践.md](./06_开发建议与最佳实践.md)
