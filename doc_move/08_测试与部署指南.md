# 08 - 测试与部署指南

> **目的**: 确保项目质量，顺利上线

---

## 1. 测试策略

### 1.1 功能测试清单

#### 基础游戏功能
- [ ] 棋盘正确显示15x15网格
- [ ] 点击可以落子
- [ ] 黑白棋子正常交替
- [ ] 五连判胜正确（横/竖/斜）
- [ ] 平局判定（225步）
- [ ] 新游戏按钮重置棋盘
- [ ] 悔棋功能工作正常

#### 禁手规则
- [ ] 三三禁手检测正确
- [ ] 四四禁手检测正确
- [ ] 长连禁手检测正确
- [ ] 白棋不受禁手限制
- [ ] 五连优先于禁手

#### AI系统
- [ ] 新手AI能正常应对
- [ ] 正常AI有一定防守能力
- [ ] 困难AI能发现简单威胁
- [ ] 地狱AI能VCF搜索
- [ ] AI思考时间符合设定

#### 游戏模式
- [ ] PvP模式双方轮流落子
- [ ] PvE模式AI自动应对
- [ ] EvE模式自动对局
- [ ] VCF模式题目加载正确
- [ ] 模式切换正常

#### 存档回放
- [ ] 保存棋局生成JSON文件
- [ ] 加载棋局恢复状态
- [ ] 回放控制器正常显示
- [ ] 播放/暂停/跳转正常
- [ ] 速度调节工作

#### VCF练习
- [ ] 题库加载完整
- [ ] 走法验证准确
- [ ] AI防守正确
- [ ] 进度保存/读取
- [ ] 难度切换正常

---

## 2. 测试方法

### 2.1 手动测试

**基础流程测试**:
```
1. 打开index.html
2. 检查控制台无错误
3. 落子测试
4. 五连测试（横/竖/斜）
5. 禁手测试（三三/四四/长连）
6. 悔棋测试
7. 新游戏测试
```

**模式测试**:
```
1. PvP模式 → 落子交替
2. PvE模式 → AI应对
3. EvE模式 → 自动对弈
4. VCF模式 → 题目练习
```

**存档测试**:
```
1. 下几步棋
2. 保存棋局
3. 刷新页面
4. 加载棋局
5. 检查状态是否一致
```

### 2.2 自动化测试（可选）

```javascript
// test/basic-test.js
function runBasicTests() {
    console.log('=== 开始基础测试 ===');
    
    // 测试1: 模块加载
    console.assert(typeof window.GomokuGame === 'function', '✅ GomokuGame模块加载');
    console.assert(typeof window.SimpleBoardRenderer === 'function', '✅ SimpleBoardRenderer模块加载');
    
    // 测试2: 落子
    const game = new GomokuGame();
    const result1 = game.placePiece(7, 7);
    console.assert(result1.success === true, '✅ 落子成功');
    
    const result2 = game.placePiece(7, 7);
    console.assert(result2.success === false, '✅ 重复落子失败');
    
    // 测试3: 胜负判定
    game.reset();
    [[7,7],[8,7],[7,8],[8,8],[7,9],[8,9],[7,10],[8,10]].forEach(([x,y]) => game.placePiece(x,y));
    const result3 = game.placePiece(7, 11);
    console.assert(result3.gameOver === true, '✅ 五连判胜');
    
    // 测试4: 禁手检测
    game.reset();
    // 构造三三局面...
    
    console.log('=== 测试完成 ===');
}
```

### 2.3 性能测试

```javascript
// 测试AI响应时间
function testAIPerformance() {
    const game = new GomokuGame();
    game.setGameMode('PvE');
    game.aiDifficulty = 'HELL';
    
    const start = performance.now();
    const move = game.getAIMove();
    const elapsed = performance.now() - start;
    
    console.log(`AI响应时间: ${elapsed.toFixed(2)}ms`);
    console.assert(elapsed < 3000, 'AI响应时间应 <3秒');
}

// 测试渲染性能
function testRenderPerformance() {
    const renderer = window.boardRenderer;
    const times = [];
    
    for (let i = 0; i < 100; i++) {
        const start = performance.now();
        renderer.render();
        times.push(performance.now() - start);
    }
    
    const avg = times.reduce((a, b) => a + b) / times.length;
    console.log(`平均渲染时间: ${avg.toFixed(2)}ms`);
    console.assert(avg < 16, '渲染应 <16ms (60fps)');
}
```

---

## 3. 兼容性测试

### 3.1 浏览器测试矩阵

| 浏览器 | 版本 | 桌面 | 移动 | 状态 |
|--------|------|------|------|------|
| Chrome | 60+ | ✅ | ✅ | 主要支持 |
| Firefox | 55+ | ✅ | ✅ | 完全兼容 |
| Safari | 12+ | ✅ | ✅ | 需要测试 |
| Edge | 79+ | ✅ | - | Chromium内核 |
| IE11 | - | ❌ | - | 不支持 |

### 3.2 测试设备

**桌面端**:
- Windows 10 + Chrome
- macOS + Safari
- Ubuntu + Firefox

**移动端**:
- iPhone (iOS Safari)
- Android (Chrome)

### 3.3 测试内容

```
桌面端:
- 鼠标点击/悬停
- 快捷键
- 模态框
- 回放控制器

移动端:
- 触摸操作
- 缩放禁用
- 横屏适配
- 按钮尺寸
```

---

## 4. 质量检查

### 4.1 代码质量

```bash
# ESLint检查
npx eslint js/**/*.js

# HTML验证
# 使用W3C Validator在线检查

# CSS验证
# 使用W3C CSS Validator
```

### 4.2 控制台检查
- 无JavaScript错误
- 无警告信息
- 无资源404
- 无CORS错误

### 4.3 性能指标

使用Chrome DevTools:
```
Performance Tab:
- 首屏加载 < 3秒
- Canvas FPS ≥ 60
- 内存使用 < 50MB

Lighthouse:
- Performance ≥ 90
- Accessibility ≥ 95
- Best Practices ≥ 90
- SEO ≥ 85
```

---

## 5. 部署步骤

### 5.1 本地部署

```bash
# 方法1: Python服务器
cd gomoku-game
python3 -m http.server 8080

# 方法2: Node.js服务器
npx http-server -p 8080 -c-1

# 方法3: VS Code Live Server
右键 index.html → Open with Live Server
```

### 5.2 GitHub Pages部署

```bash
# 1. 创建GitHub仓库
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/username/gomoku-game.git
git push -u origin main

# 2. 启用GitHub Pages
# Settings → Pages → Source: main branch → Save

# 3. 访问
# https://username.github.io/gomoku-game
```

**注意**: 确保`.nojekyll`文件存在，避免Jekyll处理。

### 5.3 Vercel/Netlify部署

**Vercel**:
```bash
# 安装Vercel CLI
npm i -g vercel

# 部署
vercel

# 生产环境
vercel --prod
```

**Netlify**:
```bash
# 拖拽部署: 将项目文件夹拖到 app.netlify.com

# 或CLI部署
npm i -g netlify-cli
netlify deploy
netlify deploy --prod
```

---

## 6. 部署检查清单

### 6.1 文件检查
- [ ] index.html存在且无语法错误
- [ ] 所有JS文件正确引入
- [ ] CSS文件正确引入
- [ ] .gitignore配置正确
- [ ] README.md编写完整

### 6.2 配置检查
- [ ] Canvas尺寸适配
- [ ] 响应式布局正常
- [ ] LocalStorage权限正常
- [ ] 文件路径正确（相对路径）

### 6.3 功能检查
- [ ] 所有游戏模式可用
- [ ] AI正常工作
- [ ] 存档/回放正常
- [ ] VCF练习正常
- [ ] 移动端友好

### 6.4 性能检查
- [ ] 首屏加载快
- [ ] 无卡顿
- [ ] 内存占用低
- [ ] AI响应及时

---

## 7. 常见部署问题

### 7.1 GitHub Pages 404

**问题**: 访问页面显示404  
**解决**:
```bash
# 1. 确保仓库名与用户名一致（用户站点）
#    或设置正确的base路径（项目站点）

# 2. 检查分支设置
#    确保Pages设置指向正确分支

# 3. 添加.nojekyll文件
touch .nojekyll
git add .nojekyll
git commit -m "Add .nojekyll"
git push
```

### 7.2 资源加载失败

**问题**: CSS/JS加载404  
**解决**:
```html
<!-- ❌ 绝对路径 -->
<script src="/js/game-core.js"></script>

<!-- ✅ 相对路径 -->
<script src="js/game-core.js"></script>
```

### 7.3 LocalStorage被禁用

**问题**: 无法保存数据  
**解决**:
```javascript
try {
    localStorage.setItem('test', 'test');
    localStorage.removeItem('test');
} catch (error) {
    console.warn('LocalStorage不可用，功能受限');
    // 降级到内存存储
}
```

---

## 8. 监控与维护

### 8.1 用户反馈收集

```html
<!-- 添加反馈链接 -->
<a href="https://github.com/username/gomoku-game/issues">
    反馈问题
</a>
```

### 8.2 错误监控（可选）

```javascript
window.addEventListener('error', (event) => {
    console.error('全局错误:', event.error);
    // 可选：发送到错误监控服务
});
```

### 8.3 版本更新

```javascript
// 检查版本
const CURRENT_VERSION = '1.2.0';
const storedVersion = localStorage.getItem('app_version');

if (storedVersion !== CURRENT_VERSION) {
    // 清除旧缓存或迁移数据
    console.log(`版本更新: ${storedVersion} → ${CURRENT_VERSION}`);
    localStorage.setItem('app_version', CURRENT_VERSION);
}
```

---

## 9. SEO优化（可选）

```html
<head>
    <title>H5五子棋 - 在线五子棋游戏</title>
    <meta name="description" content="免费在线五子棋游戏，支持双人对战、人机对战、VCF练习">
    <meta name="keywords" content="五子棋,在线游戏,双人对战,AI对战">
    <meta property="og:title" content="H5五子棋">
    <meta property="og:description" content="完整的五子棋游戏，含AI和VCF练习">
    <meta property="og:type" content="website">
</head>
```

---

## 10. 持续集成（高级）

```yaml
# .github/workflows/deploy.yml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Run tests
        run: |
          # 运行测试脚本
          
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
```

---

**总结**: 测试充分、部署顺利后，项目即可上线供用户使用

**下一步**: 查阅[09_常见问题与解决方案](./09_常见问题与解决方案.md)预防常见问题
